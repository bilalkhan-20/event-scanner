<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>QR Test Generator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js"></script>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: #0a0a0f; color: #eee; font-family: 'Segoe UI', sans-serif;
         min-height: 100vh; display: flex; flex-direction: column; align-items: center;
         justify-content: center; padding: 24px; gap: 24px; }
  h2 { font-size: 20px; color: #00e87a; letter-spacing: -0.5px; }
  .card { background: #13131a; border: 1px solid #222; border-radius: 16px;
          padding: 24px; display: flex; flex-direction: column; align-items: center;
          gap: 16px; width: 100%; max-width: 360px; }
  #qr-box { background: #fff; padding: 12px; border-radius: 8px; }
  #qr-box canvas, #qr-box img { display: block; }
  .token-label { font-family: monospace; font-size: 13px; color: #00e87a;
                 background: rgba(0,232,122,0.08); border: 1px solid rgba(0,232,122,0.2);
                 padding: 6px 14px; border-radius: 20px; }
  .btn { background: #00e87a; color: #000; border: none; border-radius: 10px;
         padding: 13px 28px; font-weight: 700; font-size: 14px; cursor: pointer;
         width: 100%; transition: opacity 0.2s; }
  .btn:hover { opacity: 0.85; }
  .btn.secondary { background: #1a1a24; color: #eee; border: 1px solid #333; }
  .result { font-family: monospace; font-size: 12px; padding: 10px 14px;
            border-radius: 8px; width: 100%; text-align: center; display: none; }
  .result.ok  { background: rgba(0,232,122,0.1); border: 1px solid rgba(0,232,122,0.3); color: #00e87a; }
  .result.err { background: rgba(255,79,79,0.1); border: 1px solid rgba(255,79,79,0.3); color: #ff4f4f; }
  .divider { color: #444; font-size: 12px; }
  input[type=file] { display: none; }
</style>
</head>
<body>

<h2>üì± QR Scanner Test Tool</h2>

<div class="card">
  <div style="font-size:13px;color:#888;text-align:center;">
    Step 1: Ye QR code download karo
  </div>
  <div id="qr-box"></div>
  <div class="token-label">DEMO001</div>
  <button class="btn" onclick="downloadQR()">‚¨áÔ∏è QR Image Download Karo</button>
</div>

<div class="card">
  <div style="font-size:13px;color:#888;text-align:center;">
    Step 2: Woh image yahan upload karo ‚Äî check karega ke scan hoti hai ya nahi
  </div>
  <button class="btn secondary" onclick="document.getElementById('test-upload').click()">
    üñºÔ∏è Image Upload Karo (Test)
  </button>
  <input type="file" id="test-upload" accept="image/*" onchange="testScan(event)"/>
  <div class="result" id="result-box"></div>
</div>

<script>
  // Generate QR
  const qr = new QRCode(document.getElementById("qr-box"), {
    text: "DEMO001",
    width: 250,
    height: 250,
    colorDark: "#000000",
    colorLight: "#ffffff",
    correctLevel: QRCode.CorrectLevel.M
  });

  function downloadQR() {
    setTimeout(() => {
      const canvas = document.querySelector("#qr-box canvas");
      const img    = document.querySelector("#qr-box img");
      const a = document.createElement("a");
      a.download = "test_qr_DEMO001.png";
      a.href = canvas ? canvas.toDataURL("image/png") : img.src;
      a.click();
    }, 300);
  }

  function testScan(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      const img = new Image();
      img.onload = function() {
        const widths = [800, 600, 1000, 400, img.width];
        let code = null;
        for (const w of widths) {
          const scale = Math.min(1, w / img.width);
          const sw = Math.floor(img.width * scale);
          const sh = Math.floor(img.height * scale);
          const c = document.createElement("canvas");
          c.width = sw; c.height = sh;
          const ctx = c.getContext("2d");
          ctx.imageSmoothingEnabled = false;
          ctx.drawImage(img, 0, 0, sw, sh);
          const d = ctx.getImageData(0, 0, sw, sh);
          code = jsQR(d.data, d.width, d.height, { inversionAttempts: "attemptBoth" });
          if (code) break;
        }
        const box = document.getElementById("result-box");
        box.style.display = "block";
        if (code) {
          box.className = "result ok";
          box.textContent = "‚úÖ Scan successful! Value: " + code.data;
        } else {
          box.className = "result err";
          box.textContent = "‚ùå QR detect nahi hua ‚Äî image clear nahi hai";
        }
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
    event.target.value = "";
  }
</script>
</body>
</html>
